#!/bin/sh

# This script backs up all Firebird databases specified in ${fbAliases} as well
# as ${fbSecurityBase}.
# Backups are taken with `gbak` and stored into ${fbBackupDir}.
# Spaces in database filenames are not supported.

fbAliases=/etc/firebird/aliases.conf
fbBackupDir=/var/lib/firebird/backup/$(date +%F)
fbSecurityBase=/var/lib/firebird/system/security2.fdb
fbBackupOpts=-t
# If your SYSDBA and/or his password are not default give'em here
#ISC_USER=
#ISC_PASSWORD=
# Backup compression command (invoked if defined)
#compressCmd="bzip2 -9"

for db in ${fbSecurityBase} $(grep -ve '^$' -e '^#' ${fbAliases} | cut -d ' ' -f 3) ; do
	[ -f ${db} ] || continue
	[ -d "${fbBackupDir}" ] || mkdir "${fbBackupDir}"
	dbBak="${fbBackupDir}/$(basename ${db})".bak
	gbak -b ${db} "${dbBak}" ${fbBackupOpts}
	[ -f "${dbBak}" -a -n "${compressCmd}" ] && ${compressCmd} ${dbBak}
done
